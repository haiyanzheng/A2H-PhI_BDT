# A2H-PhI_BDT

Article: Zheng, H, Hampson, LV. A Bayesian decision‐theoretic approach to incorporate preclinical information into phase I oncology trials. Biometrical Journal. 2020; 62: 1408– 1427. https://doi.org/10.1002/bimj.201900161

Author responsible for writing the code: Dr Haiyan Zheng.

E-mail of the author maintaining the code: haiyan.zheng@mrc-bsu.cam.ac.uk

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Content of the folder
The file describes the infra structure of the numerical studies for
the decision-theoretic approach manuscript. This infrastructure is composed of
the following files/folders:
-  [[./Sub-functions.R]] defines the prediction model for the human toxicity given preclinical 
animal data. Brief descriptions of the individual R functions, together with the arguments, 
are written in the R script. 

-  [[./Approx-function.R]] defines functions for approximating the predictive distributions
of the human toxicity with a bivariate normal distribution. 

-  [[./MixPrior_PhI.txt]] is the OpenBUGS code to be called in R for fitting our Bayesian model 
using Markov chain Monte Carlo. 

-  [[./Procedure A (No Run In).R]], [[./Procedure B (Run In).R]] and [[./Procedures CDE.R]] defines the 
adaptive procedure for dose recommendations that give the results presented in section 6. These functions
are to be called for implementation in [[./Figure6 & S2 & S3 & TableS3.R]] for simulation results.

- [[./Figure3.R]], [[./Figure4 & TableS1.R]], [[./Figure5 & TableS2.R]] and [[./Figures6 & S2 & S3 & TableS3.R]]: 
R code used to generate figures 3 - 6 of the manuscript, as well as figures S1 - S3 and tables S1 - S3 of the 
Supplementary Materials. With this, users will know how to implement the constrained (with a run-in period) 
and unconstrained (without a run-in period) versions of the proposed decision-theoretic approach. 
Results are exported and preserved in the format of .rds in the folder named Results.

- [[./Figures]]: the figures used in the manuscript and can be generated by [[./Figure3.R]],
[[./Figure4 & TableS1.R]], [[./Figure5 & TableS2.R]] and [[./Figures6 & S2 & S3 & TableS3]].

- [[./Table2.R]]: R code used to compute the effective sample size (ESS) of the animal prior. 
It reproduces Table 2 of the manuscript.

- [[./Results]] outputs of the hypothetical data examples.


Note 1: the file [[./Figures6 & S2 & S3 & TableS3.R]] does not precisely replicates the figures and tables presented 
in the manuscript, unless the user will specify the simulation parameter nsims = 1000 as was used. The default setting
of nsims = 10 is for the purpose of Biometrical Journal's efficient check for the reproducibility.

Note 2: two forms of tuning parameter \lambda^{(h)} have been suggested in the manuscript, see expressions (13) and (14).
This is reflected by the code in [[./Procedure A (No Run In).R]] and [[./Procedure B (Run In).R]]. Users need to uncomment
line 101 and 108 of the two files, respectively; i.e., where we have defined: wMix[1] = sqrt(CohSize/nCoh). With this, 
implementing [[./Figures6 & S2 & S3 & TableS3.R]] will produce results that can be visualised as Figures S2 and S3.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Run R code
#+BEGIN_SRC R :exports both :results output :session *R* :cache no
source("Sub-functions.R")
#+END_SRC

* R and package versions
#+BEGIN_SRC R  :results output   :exports results  :session *R* :cache yes 
sessionInfo()
#+END_SRC

#+RESULTS[<2019-08-12 14:28:10> b44be29e99bce3ce330d2aefe349e6976f278121]:
#+begin_example
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.3 LTS

Matrix products: default
BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C               LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
 [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8    LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] ggplot2_3.2.0      gtools_3.8.1       reshape2_1.4.3     mvtnorm_1.0-8      R2OpenBUGS_3.2-3.2

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.1       lattice_0.20-35  withr_2.1.2      crayon_1.3.4     plyr_1.8.4       grid_3.4.4      
 [7] gtable_0.3.0     magrittr_1.5     coda_0.19-3      scales_1.0.0     pillar_1.4.2     stringi_1.4.3   
[13] rlang_0.4.0      lazyeval_0.2.2   boot_1.3-20      cowplot_0.9.4    tools_3.4.4      stringr_1.4.0   
[19] munsell_0.5.0    compiler_3.4.4   pkgconfig_2.0.2  colorspace_1.4-1 tibble_2.1.3    
#+end_example

